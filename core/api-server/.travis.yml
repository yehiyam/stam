sudo: required
language: node_js
node_js:
- '8'
services:
- docker
- redis
branches:
  only:
  - master
before_install:
- docker run -d --name etcd -p 2380:2380 -p 4001:4001 quay.io/coreos/etcd:latest /usr/local/bin/etcd
  --data-dir=data.etcd --name "my-etcd" --cors='*' --initial-advertise-peer-urls http://0.0.0.0:2380
  --listen-peer-urls http://0.0.0.0:2380 --advertise-client-urls http://0.0.0.0:4001
  --listen-client-urls http://0.0.0.0:4001     --initial-cluster-state new
install:
- npm --registry http://npmhkube.ddns.net:4873 install
cache:
  directories:
  - node_modules
script:
- NODE_ENV=test npm test
after_success:
- git config --global user.email "travis@travis-ci.org"
- git config --global user.name "Travis CI"
- git remote set-url --push origin "https://${GH_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git"
- git remote -v
- git checkout -b version-branch
- npm version patch -m "$(git log -1 --pretty=%B) .... bump version [skip ci]"
- git push origin version-branch:master --follow-tags
- docker login --username yehiyam --password ${DOCKER_HUB_PASS}
deploy:
  skip_cleanup: true
  provider: script
  script: PRIVATE_REGISTRY=docker.io/hkube npm run build
  on:
    branch: master
env:
  global:
  - secure: EjfdR5XlGcNJWEL38hAPqB+Z5sxcmWurTaQLxLsgfpqxuc/xjHZRM0uGVkgAr1AtvOaFnSpCsneDaSA2VXrcDm8RPIjduSbfUFuZGwYOhAzd73kqBVE3bWc6IvtrTVAmLRwTXCUiUqKGbsVZcAVJPR+sYE1/M2DXO4JVU+NBnyrYWHNsZNULsjVWjHVrH0k1xid/YDaNODpgMlYFUyUoB60PcevSIdBGqBOgyjLsL8amtl1dSRqCQxiWbKEg+Aaf7R3OnhWWVlAi8/BdCO4qV8qwwqfzbnsduHPlZ2cJ4vxBt4CWhvt1L1ZL2yiKK17bbgUML6XReFOdSpeY975p3mLDR8xtwUPcQu2pHLDkmpfZOJJMVQUzDL9OA5BsObcmgeck0GafE6bkaF+MJqc1oOcrHrckZhdksZZ7i0SMJCMtY89TX2l0t1/qAfm+mpBmAJXKBvp3WZKCkK5XqVyU5XP4wrmDtTt8Hb8NNlHaj/x5lPYn2FLp4B4KWI6VNwHmc5g/DECgOqJptuG7e1eS1kKb6aQqdg3ybOTNr1GyBSvODYrT0U8lyFNaj/Q+jYJ4/zvLidxzlrpY+7XNnM4mwEvtBvIlWYwU/WePqQtHGIngcGmGUU0D7m9qL+w9Isjz05QhkGKxbnW8JphLySOkHoWWzEtRv1uIJEEvQWjucCw=
  - secure: cU/UqOpPtNZ24eTOMLQ+swfS551jlOepeZ6mdDMfoyfTf5eHyPZVtqZsoiRgUnVQX0ZLVALvQclD6Wm4WezBwOaBQ6EBHBe0iwlVgXKy5BUuC650RXALowsX/nuqk7futo8FStt/QGRhwp2wQA5IDNSJbnk0frFNgdkEbs/sC2G81tyMjIGLlxemtyZIUUU0CcFjTT0QqB97IuDbeamy9+mTFBcyC4gGgOLhmPnxbOef3TmPOpNXcw4ViwFE+APIcwnqR5jaB1rYoDhn0PpBk1RKqZFhWum3TPWAl13BsrDqq8pQQH1FhzVQ4XYdRKOUnCAXwoyedR3ZzZ4XBdU+1eMnSAA0r1aXtDSps5ZxUOyBNwis4oEqrwlYKhukIUrhQ2yl6/2kh3f0CQCbxLtbN8f7WpBOdJoeb1nCAE6y3mu2BCgojvlMb4/Y+EazOlGbKuVF+3nBIScYaSgs+xYYRZNGw+xbrEceDO2/YVbSjlZxkRyZRG0VbAiYTNRClW+ToQW+3zZNDNB08q2Fa1AHo6ZJ5MUqsMf64IX+Xs51GEXv3bJzCZSTe/xlU/PjZ8+mp+6E/0P3OThv49j673fttfKTMF8lauFhDEH4HE1vIiVXiNsDYn43lGZLEl07FFs4i/zoh6is74ibOLQmrl+Qx+t6Of2WrA1BiUM2dinxtgo=
